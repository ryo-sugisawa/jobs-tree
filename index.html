<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ジョブツリー</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    .node rect {
      fill: white;
      stroke: black;
      stroke-width: 2px;
    }

    .node text {
      font: 14px sans-serif;
      fill: black;
    }

    .link {
      fill: none;
      stroke: #000;
      stroke-width: 1.5px;
    }
  </style>
</head>
<body>
  <h1>ジョブツリー</h1>
  <svg width="800" height="600"></svg>

  <script>
    d3.json("jobs.json").then(function(data) {
      const svg = d3.select("svg"),
            width = +svg.attr("width"),
            height = +svg.attr("height");

      const treeLayout = d3.tree().size([height - 100, width - 200]);
      const root = d3.hierarchy(data);
      treeLayout(root);

      // 枝（リンク）描画
      svg.selectAll('.link')
        .data(root.links())
        .enter()
        .append('path')
        .attr('class', 'link')
        .attr('d', d3.linkHorizontal()
          .x(d => d.y + 100)
          .y(d => d.x + 50));

      // ノード（四角＋テキスト）
      const node = svg.selectAll('.node')
        .data(root.descendants())
        .enter()
        .append('g')
        .attr('class', 'node')
        .attr('transform', d => `translate(${d.y + 100},${d.x + 50})`);

      node.append('rect')
        .attr('width', 140)
        .attr('height', 30)
        .attr('x', -70)
        .attr('y', -15)
        .attr('rx', 5)
        .attr('ry', 5);

      node.append('text')
        .attr('dy', '0.35em')
        .attr('text-anchor', 'middle')
        .text(d => d.data.name);
    });
  </script>
</body>
</html>
